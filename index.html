<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>AI测运势，新年第一签</title>
        <link rel="stylesheet" href="style.css">
        <!-- Privacy-friendly analytics by Plausible -->
        <script async src="https://plausible.io/js/pa-S_ZYb6vcqp992cEPZSLb6.js"></script>
        <script>
            window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
            plausible.init()
        </script>
    </head>
<body>
    <!-- 抽签页面 -->
    <div id="draw-page" class="page">
        <div id="snow-container" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 100;"></div>
        <h1>AI测运势，新年第一签</h1>
        <div class="carousel-container">
            <div id="carousel" class="carousel">
                <!-- 旋转木马内容将由JS生成 -->
            </div>
        </div>
        <p style="color: #FEF2DC; text-shadow: 1px 1px 2px rgba(176, 34, 27, 0.3); font-size: 16px; margin: 20px 0; text-align: center; font-family: 'STKaiti', 'KaiTi', serif;">用心祈福，抽出专属你的新年签</p>
        <div style="width: 100%; display: flex; justify-content: center; margin-top: 10px;">
            <button id="draw-btn" class="draw-btn">开始抽签</button>
        </div>
    </div>

    <style>
    /* 雪花动画 */
    @keyframes fall {
        0% {
            transform: translateY(-20px) rotate(0deg);
            opacity: 0.5;
        }
        100% {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
        }
    }
    </style>

    <script>
    // 为index页面创建雪花
    function initSnow() {
        // 创建雪花
        const snowContainer = document.getElementById('snow-container');
        if (snowContainer) {
            for (let i = 0; i < 50; i++) {
                const snowflake = document.createElement('div');
                snowflake.style.position = 'absolute';
                snowflake.style.width = (Math.random() * 10 + 5) + 'px';
                snowflake.style.height = snowflake.style.width;
                snowflake.style.backgroundColor = '#ffffff';
                snowflake.style.borderRadius = '50%';
                snowflake.style.opacity = '0.9';
                snowflake.style.left = (Math.random() * 100) + '%';
                // 随机位置，不只是从顶部开始
                snowflake.style.top = (Math.random() * 100) + '%';
                snowflake.style.boxShadow = '0 0 10px #ffffff';
                snowflake.style.animation = 'fall ' + (Math.random() * 5 + 5) + 's linear infinite';
                snowflake.style.animationDelay = '0s';
                snowflake.style.zIndex = '10';
                snowContainer.appendChild(snowflake);
            }
        }
    }
    </script>
    


    <!-- 结果页面 -->
    <div id="result-page" class="page hidden">
        <div class="result-container">
            <h2 id="hexagram-name"></h2>
            <div id="hexagram-explanation"></div>
            <button id="reset-btn" class="reset-btn">重新抽签</button>
        </div>
        <div id="petals-container"></div>
    </div>

    <script src="script.js"></script>
    <script>
        // 预加载关键页面
        function preloadPages() {
            // 预加载result.html
            const resultFrame = document.createElement('iframe');
            resultFrame.src = 'result.html';
            resultFrame.style.display = 'none';
            resultFrame.style.width = '0';
            resultFrame.style.height = '0';
            resultFrame.style.border = '0';
            document.body.appendChild(resultFrame);
            
            // 预加载card-preview.html
            setTimeout(() => {
                const previewFrame = document.createElement('iframe');
                previewFrame.src = 'card-preview.html';
                previewFrame.style.display = 'none';
                previewFrame.style.width = '0';
                previewFrame.style.height = '0';
                previewFrame.style.border = '0';
                document.body.appendChild(previewFrame);
            }, 1000); // 延迟1秒，避免同时加载过多资源
        }
        
        // 访问统计功能
        function trackVisit() {
            // 生成设备ID（基于用户代理和屏幕信息）
            function generateDeviceId() {
                const userAgent = navigator.userAgent;
                const screenInfo = `${screen.width}x${screen.height}-${screen.colorDepth}`;
                const platform = navigator.platform;
                // 简单的哈希函数
                let hash = 0;
                const str = userAgent + screenInfo + platform;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // 转换为32位整数
                }
                return Math.abs(hash).toString(16);
            }
            
            // 获取设备类型
            function getDeviceType() {
                const userAgent = navigator.userAgent;
                if (/mobile/i.test(userAgent)) {
                    return 'Mobile';
                } else if (/tablet/i.test(userAgent)) {
                    return 'Tablet';
                } else {
                    return 'Desktop';
                }
            }
            
            // 获取或创建访问数据
            const visitData = JSON.parse(localStorage.getItem('visitData')) || {
                totalVisits: 0,
                uniqueDevices: {},
                todayVisits: 0,
                lastReset: new Date().toDateString()
            };
            
            // 检查是否需要重置今日访问次数
            const today = new Date().toDateString();
            if (visitData.lastReset !== today) {
                visitData.todayVisits = 0;
                visitData.lastReset = today;
            }
            
            // 生成设备ID
            const deviceId = generateDeviceId();
            const deviceType = getDeviceType();
            
            // 更新访问数据
            visitData.totalVisits++;
            visitData.todayVisits++;
            
            // 更新设备信息
            if (!visitData.uniqueDevices[deviceId]) {
                visitData.uniqueDevices[deviceId] = {
                    deviceType: deviceType,
                    userAgent: navigator.userAgent,
                    firstVisit: new Date().toISOString(),
                    visitCount: 0
                };
            }
            visitData.uniqueDevices[deviceId].visitCount++;
            visitData.uniqueDevices[deviceId].lastVisit = new Date().toISOString();
            
            // 保存数据到localStorage
            localStorage.setItem('visitData', JSON.stringify(visitData));
        }
        
        // 页面加载时执行访问统计
        window.onload = function() {
            // 添加页面加载动画
            document.body.classList.remove('page-transition');
            
            // 先执行原有的雪花效果
            if (typeof initSnow === 'function') {
                initSnow();
            }
            // 执行旋转木马初始化
            if (typeof initCarousel === 'function') {
                initCarousel();
            }
            // 执行雪花效果（如果存在）
            if (typeof createSnowflakes === 'function') {
                createSnowflakes();
            }
            // 执行访问统计
            trackVisit();
            // 预加载关键页面
            preloadPages();
        };
        
        // 页面跳转时添加动画
        function navigateTo(url) {
            // 添加离开动画
            document.body.style.opacity = '0';
            document.body.style.transform = 'translateY(-20px)';
            
            // 延迟跳转，让动画完成
            setTimeout(function() {
                window.location.href = url;
            }, 200);
        }
    </script>
    <div class="footer">本应用仅供娱乐</div>
</body>
</html>
